import{r,e as se,j as e}from"./index-Czv1AGCs.js";import{c as re,a as ie,d as F,t as ne,u as oe,s as ae,b as le,e as ce,f as ue,n as de}from"./consistency-BpvqZ4ZH.js";const j=[{id:"red",color:"#E25B45",label:"Red berry"},{id:"blue",color:"#4A82C8",label:"Blue berry"},{id:"yellow",color:"#E8C84A",label:"Yellow berry"},{id:"purple",color:"#8B5FB0",label:"Purple berry"}],he=8,pe=12,fe=700,xe=800,i={SHOWING:"showing",RESPONDING:"responding",FEEDBACK:"feedback",PAUSED:"paused"};function Ee({ageBand:p,onComplete:T}){const[x,z]=r.useState(()=>re(p)),[m,L]=r.useState(0),[o,E]=r.useState(i.PAUSED),[c,q]=r.useState([]),[b,S]=r.useState(-1),[g,v]=r.useState([]),[w,D]=r.useState(null),[R,H]=r.useState([]),A=r.useRef(null),d=r.useRef([]),C=r.useCallback(()=>{d.current.forEach(clearTimeout),d.current=[]},[]);r.useEffect(()=>()=>C(),[C]);const B=r.useCallback(s=>{const t=ue(s,p),a=[];for(let u=0;u<t;u++)a.push(j[Math.floor(Math.random()*j.length)]);return a},[p]),I=r.useCallback(()=>{const s=B(x.b);q(s),v([]),D(null),S(0),E(i.SHOWING)},[x.b,B]);r.useEffect(()=>{if(o!==i.SHOWING)return;if(b>=c.length){const t=setTimeout(()=>{S(-1),E(i.RESPONDING),A.current=performance.now()},300);d.current.push(t);return}const s=setTimeout(()=>{S(t=>t+1)},fe);d.current.push(s)},[o,b,c.length]);const P=r.useCallback(s=>{if(o!==i.RESPONDING)return;const t=[...g,s];if(v(t),t.length>=c.length){const a=performance.now()-A.current,u=t.every((l,f)=>l.id===c[f].id);let G=null;u||(G=t.findIndex((l,f)=>l.id!==c[f].id));const M=de(a,p),_={trialNum:m,correct:u,rt:a,rtNorm:M,difficulty:x.b,sequenceLength:c.length,firstErrorPosition:G,module:"WM"},N=[...R,_],O=ie(N,4)||a,K=F(N,O),U=ne(m,K.fatigueOnset),y=oe(x,u,a,p,{responseWeight:U});z(y);const h=N;H(h),D(u),E(i.FEEDBACK);const W=m+1;if(ae(y,W,he,pe)){const l=h.map(n=>n.rt),f=le(l),V=l.reduce((n,te)=>n+te,0)/l.length,Y=F(h,O||V),$=se(h.map(n=>({correct:n.correct,rtNorm:n.rtNorm,rt:n.rt})),f),J=ce(l),Q=h.filter(n=>!n.correct&&n.firstErrorPosition===0).length,Z=h.filter(n=>!n.correct&&n.firstErrorPosition===n.sequenceLength-1).length,ee=setTimeout(()=>{T({theta:y.theta,thetaSE:y.se,thetaCI:y.ci,itv:f,ddm:$,engagementFatigued:Y.fatigued,trials:h,extras:{primacyErrors:Q,recencyErrors:Z,exgauss:J}})},600);d.current.push(ee);return}L(W);const X=setTimeout(()=>{E(i.PAUSED);const l=setTimeout(()=>I(),xe);d.current.push(l)},600);d.current.push(X)}},[o,g,c,x,m,R,p,T,I]);r.useEffect(()=>{if(m===0&&o===i.PAUSED){const s=setTimeout(()=>I(),500);d.current.push(s)}},[]);const k=64;return e.jsxs("div",{className:"game-area",style:{background:"#D4E8DF",position:"relative"},children:[e.jsxs("svg",{viewBox:"0 0 800 600",style:{position:"absolute",inset:0,width:"100%",height:"100%"},"aria-hidden":"true",children:[e.jsx("rect",{x:"0",y:"0",width:"800",height:"350",fill:"#C8E6C9"}),e.jsx("ellipse",{cx:"400",cy:"380",rx:"500",ry:"60",fill:"#81C4E8",opacity:"0.5",children:e.jsx("animate",{attributeName:"rx",values:"500;480;500",dur:"4s",repeatCount:"indefinite"})}),e.jsx("ellipse",{cx:"400",cy:"400",rx:"500",ry:"50",fill:"#64B5D6",opacity:"0.4",children:e.jsx("animate",{attributeName:"rx",values:"500;510;500",dur:"3.5s",repeatCount:"indefinite"})}),e.jsx("rect",{x:"0",y:"430",width:"800",height:"170",fill:"#A8D5BA"})]}),e.jsx("div",{style:{position:"absolute",top:12,left:0,right:0,textAlign:"center",fontFamily:"var(--font-game, 'Nunito')",fontSize:"clamp(0.85rem, 2.5vw, 1.1rem)",color:"#2C3E35",padding:"0 16px",zIndex:2},children:o===i.SHOWING?"Watch the berries!":o===i.RESPONDING?"Now tap them in order!":o===i.FEEDBACK?w?"Great job!":"Nice try!":"Let's go!"}),e.jsx("div",{style:{position:"absolute",top:"12%",left:"50%",transform:"translateX(-50%)",display:"flex",gap:16,zIndex:2},children:c.map((s,t)=>{const a=o===i.SHOWING&&t===b,u=o===i.RESPONDING&&g[t];return e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("svg",{width:k,height:k,viewBox:"0 0 64 64",children:[e.jsx("circle",{cx:"32",cy:"36",r:"22",fill:a?s.color:"#D5D5D0",opacity:a?1:.4,style:{transition:"fill 0.2s, opacity 0.2s"}}),e.jsx("ellipse",{cx:"32",cy:"14",rx:"3",ry:"6",fill:"#5B8C5A"}),e.jsx("circle",{cx:"26",cy:"30",r:"4",fill:"white",opacity:a?.3:0})]}),u&&e.jsx("div",{style:{position:"absolute",bottom:-4,left:"50%",transform:"translateX(-50%)",width:8,height:8,borderRadius:"50%",background:"var(--primary)"}})]},t)})}),o===i.RESPONDING&&e.jsx("div",{style:{position:"absolute",bottom:"12%",left:"50%",transform:"translateX(-50%)",display:"flex",gap:20,zIndex:2},children:j.map(s=>e.jsx("button",{onClick:()=>P(s),onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&P(s)},role:"button","aria-label":`Tap ${s.label}`,tabIndex:0,style:{width:72,height:72,border:"none",background:"transparent",cursor:"pointer",padding:0,animation:"pulse 2s ease-in-out infinite"},children:e.jsxs("svg",{width:"72",height:"72",viewBox:"0 0 72 72",children:[e.jsx("ellipse",{cx:"36",cy:"40",rx:"32",ry:"20",fill:"#6BAF6B",opacity:"0.8"}),e.jsx("ellipse",{cx:"36",cy:"38",rx:"28",ry:"16",fill:"#7EC87E"}),e.jsx("circle",{cx:"36",cy:"32",r:"16",fill:s.color}),e.jsx("ellipse",{cx:"36",cy:"22",rx:"2",ry:"5",fill:"#5B8C5A"}),e.jsx("circle",{cx:"30",cy:"28",r:"3",fill:"white",opacity:"0.3"})]})},s.id))}),o===i.RESPONDING&&e.jsx("div",{style:{position:"absolute",bottom:"4%",left:"50%",transform:"translateX(-50%)",display:"flex",gap:6,zIndex:2},children:c.map((s,t)=>e.jsx("div",{style:{width:10,height:10,borderRadius:"50%",background:t<g.length?"var(--primary)":"#ccc",transition:"background 0.2s"}},t))}),o===i.FEEDBACK&&e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:5,pointerEvents:"none"},children:e.jsx("div",{style:{fontSize:"3rem",animation:"softBounce 0.6s ease-out"},"aria-hidden":"true",children:w?"â­":"ðŸ’š"})})]})}export{Ee as default};
