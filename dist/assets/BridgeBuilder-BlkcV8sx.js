import{r as t,e as A,j as e}from"./index-Czv1AGCs.js";import{c as se,b as N,a as F,d as T,e as $,t as le,u as ie,s as te,n as oe}from"./consistency-BpvqZ4ZH.js";const ae=[{id:1,type:1,difficulty:-2.5,sequence:[{color:"red"},{color:"blue"},{color:"red"},null,{color:"red"}],answer:{color:"blue"},distractors:[{color:"red"},{color:"yellow"},{color:"purple"}]},{id:2,type:1,difficulty:-2.2,sequence:[{color:"yellow"},{color:"purple"},{color:"yellow"},null],answer:{color:"purple"},distractors:[{color:"yellow"},{color:"red"},{color:"blue"}]},{id:3,type:1,difficulty:-1.8,sequence:[{color:"red"},{color:"blue"},{color:"yellow"},{color:"red"},null],answer:{color:"blue"},distractors:[{color:"red"},{color:"yellow"},{color:"purple"}]},{id:4,type:1,difficulty:-1.5,sequence:[{color:"green"},{color:"orange"},{color:"green"},{color:"orange"},null],answer:{color:"green"},distractors:[{color:"orange"},{color:"blue"},{color:"red"}]},{id:5,type:2,difficulty:-1.4,sequence:[{shape:"circle"},{shape:"square"},{shape:"circle"},null],answer:{shape:"square"},distractors:[{shape:"circle"},{shape:"triangle"},{shape:"star"}]},{id:6,type:2,difficulty:-1.2,sequence:[{shape:"triangle"},{shape:"star"},{shape:"triangle"},{shape:"star"},null],answer:{shape:"triangle"},distractors:[{shape:"star"},{shape:"circle"},{shape:"square"}]},{id:7,type:2,difficulty:-1,sequence:[{shape:"circle"},{shape:"square"},{shape:"triangle"},{shape:"circle"},null],answer:{shape:"square"},distractors:[{shape:"circle"},{shape:"triangle"},{shape:"star"}]},{id:8,type:2,difficulty:-.8,sequence:[{shape:"star"},{shape:"triangle"},{shape:"circle"},{shape:"star"},{shape:"triangle"},null],answer:{shape:"circle"},distractors:[{shape:"star"},{shape:"triangle"},{shape:"square"}]},{id:9,type:3,difficulty:-.7,sequence:[{size:"big"},{size:"small"},{size:"big"},null],answer:{size:"small"},distractors:[{size:"big"},{size:"big"},{size:"big"}]},{id:10,type:3,difficulty:-.5,sequence:[{size:"big"},{size:"big"},{size:"small"},{size:"big"},{size:"big"},null],answer:{size:"small"},distractors:[{size:"big"},{size:"big"},{size:"big"}]},{id:11,type:3,difficulty:-.3,sequence:[{size:"small"},{size:"big"},{size:"small"},{size:"big"},null],answer:{size:"small"},distractors:[{size:"big"},{size:"big"},{size:"big"}]},{id:12,type:4,difficulty:-.2,sequence:[{color:"red",shape:"circle"},{color:"blue",shape:"square"},{color:"red",shape:"circle"},null],answer:{color:"blue",shape:"square"},distractors:[{color:"red",shape:"square"},{color:"blue",shape:"circle"},{color:"yellow",shape:"triangle"}]},{id:13,type:4,difficulty:0,sequence:[{color:"yellow",shape:"triangle"},{color:"purple",shape:"star"},{color:"yellow",shape:"triangle"},{color:"purple",shape:"star"},null],answer:{color:"yellow",shape:"triangle"},distractors:[{color:"purple",shape:"triangle"},{color:"yellow",shape:"star"},{color:"red",shape:"circle"}]},{id:14,type:4,difficulty:.2,sequence:[{color:"red",shape:"circle"},{color:"blue",shape:"triangle"},{color:"yellow",shape:"square"},{color:"red",shape:"circle"},null],answer:{color:"blue",shape:"triangle"},distractors:[{color:"red",shape:"triangle"},{color:"blue",shape:"square"},{color:"yellow",shape:"circle"}]},{id:15,type:4,difficulty:.4,sequence:[{color:"green",shape:"star"},{color:"orange",shape:"circle"},{color:"green",shape:"star"},null],answer:{color:"orange",shape:"circle"},distractors:[{color:"green",shape:"circle"},{color:"orange",shape:"star"},{color:"blue",shape:"square"}]},{id:16,type:5,difficulty:.5,sequence:[{direction:"right"},{direction:"down"},{direction:"right"},null],answer:{direction:"down"},distractors:[{direction:"right"},{direction:"up"},{direction:"left"}]},{id:17,type:5,difficulty:.7,sequence:[{direction:"up"},{direction:"right"},{direction:"down"},{direction:"left"},null],answer:{direction:"up"},distractors:[{direction:"down"},{direction:"right"},{direction:"left"}]},{id:18,type:5,difficulty:.9,sequence:[{direction:"up"},{direction:"right"},{direction:"down"},{direction:"up"},{direction:"right"},null],answer:{direction:"down"},distractors:[{direction:"up"},{direction:"right"},{direction:"left"}]},{id:19,type:5,difficulty:1.1,sequence:[{direction:"left"},{direction:"up"},{direction:"right"},{direction:"left"},null],answer:{direction:"up"},distractors:[{direction:"left"},{direction:"down"},{direction:"right"}]},{id:20,type:6,difficulty:1.2,sequence:[{color:"red",size:"big"},{color:"blue",size:"small"},{color:"red",size:"big"},null],answer:{color:"blue",size:"small"},distractors:[{color:"red",size:"small"},{color:"blue",size:"big"},{color:"yellow",size:"small"}]},{id:21,type:6,difficulty:1.4,sequence:[{shape:"circle",size:"big"},{shape:"square",size:"small"},{shape:"circle",size:"big"},{shape:"square",size:"small"},null],answer:{shape:"circle",size:"big"},distractors:[{shape:"circle",size:"small"},{shape:"square",size:"big"},{shape:"triangle",size:"big"}]},{id:22,type:6,difficulty:1.5,sequence:[{color:"yellow",shape:"triangle"},{color:"purple",shape:"circle"},{color:"yellow",shape:"triangle"},null],answer:{color:"purple",shape:"circle"},distractors:[{color:"yellow",shape:"circle"},{color:"purple",shape:"triangle"},{color:"red",shape:"star"}]},{id:23,type:6,difficulty:1.7,sequence:[{color:"green",size:"small"},{color:"orange",size:"big"},{color:"green",size:"small"},{color:"orange",size:"big"},{color:"green",size:"small"},null],answer:{color:"orange",size:"big"},distractors:[{color:"green",size:"big"},{color:"orange",size:"small"},{color:"blue",size:"big"}]},{id:24,type:7,difficulty:1.8,sequence:[{color:"red",shape:"circle",size:"big"},{color:"blue",shape:"square",size:"small"},{color:"red",shape:"circle",size:"big"},null],answer:{color:"blue",shape:"square",size:"small"},distractors:[{color:"red",shape:"square",size:"small"},{color:"blue",shape:"circle",size:"big"},{color:"yellow",shape:"triangle",size:"small"}]},{id:25,type:7,difficulty:2,sequence:[{color:"yellow",shape:"triangle",size:"small"},{color:"purple",shape:"star",size:"big"},{color:"yellow",shape:"triangle",size:"small"},{color:"purple",shape:"star",size:"big"},null],answer:{color:"yellow",shape:"triangle",size:"small"},distractors:[{color:"purple",shape:"triangle",size:"small"},{color:"yellow",shape:"star",size:"big"},{color:"red",shape:"circle",size:"small"}]},{id:26,type:7,difficulty:2.1,sequence:[{color:"red",shape:"square",size:"big"},{color:"blue",shape:"triangle",size:"small"},{color:"yellow",shape:"circle",size:"big"},{color:"red",shape:"square",size:"small"},null],answer:{color:"blue",shape:"triangle",size:"big"},distractors:[{color:"blue",shape:"square",size:"small"},{color:"yellow",shape:"triangle",size:"small"},{color:"red",shape:"circle",size:"big"}]},{id:27,type:7,difficulty:2.2,sequence:[{color:"green",shape:"star",size:"small"},{color:"orange",shape:"circle",size:"big"},{color:"green",shape:"star",size:"small"},null],answer:{color:"orange",shape:"circle",size:"big"},distractors:[{color:"green",shape:"circle",size:"big"},{color:"orange",shape:"star",size:"small"},{color:"purple",shape:"square",size:"big"}]},{id:28,type:7,difficulty:2.3,sequence:[{color:"red",shape:"circle",size:"big"},{color:"blue",shape:"triangle",size:"small"},{color:"yellow",shape:"square",size:"big"},{color:"red",shape:"circle",size:"small"},{color:"blue",shape:"triangle",size:"big"},null],answer:{color:"yellow",shape:"square",size:"small"},distractors:[{color:"yellow",shape:"triangle",size:"big"},{color:"blue",shape:"square",size:"small"},{color:"red",shape:"square",size:"big"}]},{id:29,type:7,difficulty:2.4,sequence:[{color:"purple",shape:"star",size:"big"},{color:"green",shape:"triangle",size:"small"},{color:"orange",shape:"circle",size:"big"},{color:"purple",shape:"star",size:"small"},null],answer:{color:"green",shape:"triangle",size:"big"},distractors:[{color:"green",shape:"star",size:"small"},{color:"orange",shape:"triangle",size:"big"},{color:"purple",shape:"circle",size:"small"}]},{id:30,type:7,difficulty:2.5,sequence:[{color:"red",shape:"square",size:"small"},{color:"blue",shape:"circle",size:"big"},{color:"yellow",shape:"star",size:"small"},{color:"red",shape:"square",size:"big"},{color:"blue",shape:"circle",size:"small"},null],answer:{color:"yellow",shape:"star",size:"big"},distractors:[{color:"yellow",shape:"circle",size:"small"},{color:"red",shape:"star",size:"big"},{color:"blue",shape:"square",size:"small"}]}];function O(o,a=new Set){const r=ae.filter(l=>!a.has(l.id));return r.length===0?null:(r.sort((l,n)=>Math.abs(l.difficulty-o)-Math.abs(n.difficulty-o)),r[0])}function ce(o){const a=[{...o.answer,isCorrect:!0},...o.distractors.map(r=>({...r,isCorrect:!1}))];for(let r=a.length-1;r>0;r--){const l=Math.floor(Math.random()*(r+1));[a[r],a[l]]=[a[l],a[r]]}return a}const ne=10,W=14,ue={red:"#E25B45",blue:"#4A82C8",yellow:"#E8C84A",purple:"#8B5FB0",green:"#5B8C5A",orange:"#E87C3F"},de={big:36,small:22};function _(o,a=32){const r=ue[o.color]??"#888",l=de[o.size]??a,n=o.shape??"circle",z=o.direction;if(z){const c={up:"M 20,35 L 20,10 L 12,18 M 20,10 L 28,18",down:"M 20,5 L 20,30 L 12,22 M 20,30 L 28,22",left:"M 35,20 L 10,20 L 18,12 M 10,20 L 18,28",right:"M 5,20 L 30,20 L 22,12 M 30,20 L 22,28"};return e.jsxs("svg",{width:40,height:40,viewBox:"0 0 40 40",children:[e.jsx("rect",{x:"2",y:"2",width:"36",height:"36",rx:"6",fill:"#E8E0D4"}),e.jsx("path",{d:c[z]??c.right,stroke:"#4A3728",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]})}return e.jsxs("svg",{width:40,height:40,viewBox:"0 0 40 40",children:[e.jsx("rect",{x:"2",y:"2",width:"36",height:"36",rx:"6",fill:"#E8E0D4"}),n==="circle"&&e.jsx("circle",{cx:"20",cy:"20",r:l/2.2,fill:r}),n==="square"&&e.jsx("rect",{x:20-l/2.4,y:20-l/2.4,width:l/1.2,height:l/1.2,rx:"2",fill:r}),n==="triangle"&&e.jsx("polygon",{points:`20,${20-l/2.2} ${20+l/2.2},${20+l/2.5} ${20-l/2.2},${20+l/2.5}`,fill:r}),n==="star"&&e.jsx("polygon",{points:"20,8 23,16 32,16 25,21 27,30 20,25 13,30 15,21 8,16 17,16",fill:r,transform:`scale(${l/36})`,style:{transformOrigin:"20px 20px"}}),!n&&!z&&e.jsx("circle",{cx:"20",cy:"20",r:l/2.2,fill:r})]})}function ge({ageBand:o,onComplete:a}){const[r,l]=t.useState(()=>se(o)),[n,z]=t.useState(0),[c,G]=t.useState(null),[H,P]=t.useState([]),[y,E]=t.useState(null),[B,M]=t.useState(null),[h,X]=t.useState([]),[q,V]=t.useState(new Set),[m,K]=t.useState(0),L=t.useRef(null),j=t.useRef(null);t.useEffect(()=>()=>{j.current&&clearTimeout(j.current)},[]);const I=t.useCallback(()=>{const s=O(r.b,q);if(!s){U();return}G(s),P(ce(s)),E(null),M(null),L.current=performance.now(),V(i=>new Set([...i,s.id]))},[r.b,q]);t.useEffect(()=>{I()},[]);const U=t.useCallback(()=>{const s=h.map(p=>p.rt),i=N(s),u=s.length>0?s.reduce((p,C)=>p+C,0)/s.length:2e3,w=F(h,5)||u,d=T(h,w),g=A(h.map(p=>({correct:p.correct,rtNorm:p.rtNorm,rt:p.rt})),i),S=$(s);a({theta:r.theta,thetaSE:r.se,thetaCI:r.ci,itv:i,ddm:g,engagementFatigued:d.fatigued,trials:h,extras:{highestPatternType:m,exgauss:S}})},[h,r.theta,r.se,r.ci,m,a]),R=t.useCallback((s,i)=>{if(y!==null||!c)return;E(i);const u=performance.now()-L.current,w=oe(u,o),d=s.isCorrect;d&&c.type>m&&K(c.type);const g=[...h,{trialNum:n,correct:d,rt:u,rtNorm:w,difficulty:c.difficulty,itemType:c.type,chosenIndex:i,module:"VS"}],S=F(g,5)||u,p=T(g,S),C=le(n,p.fatigueOnset),b=ie(r,d,u,o,{responseWeight:C});l(b),M(d);const x=g;X(x);const k=n+1;if(te(b,k,ne,W)||!O(b.b,q)){j.current=setTimeout(()=>{const v=x.map(f=>f.rt),D=N(v),J=v.reduce((f,re)=>f+re,0)/v.length,Q=T(x,S||J),Y=A(x.map(f=>({correct:f.correct,rtNorm:f.rtNorm,rt:f.rt})),D),ee=$(v);a({theta:b.theta,thetaSE:b.se,thetaCI:b.ci,itv:D,ddm:Y,engagementFatigued:Q.fatigued,trials:x,extras:{highestPatternType:d&&c.type>m?c.type:m,exgauss:ee}})},800);return}z(k),j.current=setTimeout(()=>{I()},800)},[y,c,r,n,h,o,m,q,a,I]),Z=t.useMemo(()=>c?c.sequence.map((s,i)=>({tile:s,isGap:s===null,index:i})):[],[c]);return c?e.jsxs("div",{className:"game-area",style:{background:"#DDD5C4",position:"relative"},children:[e.jsxs("svg",{viewBox:"0 0 800 600",style:{position:"absolute",inset:0,width:"100%",height:"100%"},"aria-hidden":"true",children:[e.jsx("rect",{x:"0",y:"0",width:"800",height:"300",fill:"#B8CCE0",opacity:"0.3"}),e.jsx("rect",{x:"0",y:"300",width:"800",height:"300",fill:"#A8BCA0",opacity:"0.3"}),e.jsx("rect",{x:"50",y:"240",width:"700",height:"30",rx:"4",fill:"#8B7355"}),e.jsx("rect",{x:"50",y:"270",width:"700",height:"10",fill:"#6B5335"}),e.jsx("rect",{x:"80",y:"270",width:"15",height:"120",fill:"#8B7355"}),e.jsx("rect",{x:"705",y:"270",width:"15",height:"120",fill:"#8B7355"}),e.jsx("rect",{x:"380",y:"270",width:"15",height:"120",fill:"#8B7355"}),e.jsx("rect",{x:"0",y:"380",width:"800",height:"220",fill:"#81C4E8",opacity:"0.3"})]}),e.jsx("div",{style:{position:"absolute",top:10,left:0,right:0,textAlign:"center",fontFamily:"var(--font-game, 'Nunito')",fontSize:"clamp(0.8rem, 2vw, 1rem)",color:"#2C3E35",zIndex:10,padding:"0 16px"},children:"Find the missing stone!"}),e.jsx("div",{style:{position:"absolute",top:"18%",left:"50%",transform:"translateX(-50%)",display:"flex",gap:8,alignItems:"center",zIndex:5},children:Z.map(({tile:s,isGap:i,index:u})=>i?e.jsx("div",{style:{width:44,height:44,border:"3px dashed var(--accent)",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.5)",animation:"pulse 2s ease-in-out infinite"},children:e.jsx("span",{style:{fontSize:"1.2rem",color:"var(--accent)"},children:"?"})},u):e.jsx("div",{children:_(s)},u))}),e.jsx("div",{style:{position:"absolute",bottom:"10%",left:"50%",transform:"translateX(-50%)",display:"grid",gridTemplateColumns:"1fr 1fr",gap:12,zIndex:5},children:H.map((s,i)=>{const u=y===i,w=y!==null;let d="transparent";return w&&u&&(d=s.isCorrect?"#4A7C6F":"#D4956A"),e.jsx("button",{onClick:()=>R(s,i),onKeyDown:g=>{(g.key==="Enter"||g.key===" ")&&R(s,i)},role:"button",tabIndex:0,"aria-label":`Option ${i+1}`,disabled:y!==null,style:{width:64,height:64,border:`3px solid ${d}`,borderRadius:12,background:"white",cursor:y!==null?"default":"pointer",padding:8,display:"flex",alignItems:"center",justifyContent:"center",transition:"border-color 0.2s, transform 0.15s",transform:u?"scale(1.05)":"scale(1)",boxShadow:"var(--shadow-sm)",minHeight:44,minWidth:44},children:_(s,28)},i)})}),B!==null&&e.jsx("div",{style:{position:"absolute",top:"45%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"2.5rem",zIndex:20,pointerEvents:"none",animation:"softBounce 0.6s ease-out"},"aria-hidden":"true",children:B?"‚≠ê":"üíö"}),e.jsxs("div",{style:{position:"absolute",bottom:8,right:12,fontFamily:"var(--font-game, 'Nunito')",fontSize:"0.8rem",color:"#6B7F78",zIndex:10},"aria-hidden":"true",children:[n+1,"/",W]})]}):e.jsx("div",{className:"game-area",style:{background:"#DDD5C4",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontFamily:"var(--font-game)",color:"var(--text-light)"},children:"Loading..."})})}export{ge as default};
