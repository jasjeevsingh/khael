import{r as a,e as Z,j as e}from"./index-Czv1AGCs.js";import{c as ee,a as te,d as $,t as re,u as ie,s as se,b as le,e as ae,n as ne}from"./consistency-BpvqZ4ZH.js";const ce=10,R=12,oe=["happy","sad","scared","angry","surprised"],S={happy:{eyes:"‚ó†",mouth:"‚Äø",color:"#E8C84A",label:"Happy"},sad:{eyes:"‚ó°",mouth:"‚å¢",color:"#4A82C8",label:"Sad"},scared:{eyes:"‚óè",mouth:"O",color:"#8B5FB0",label:"Scared"},angry:{eyes:"‚ñº",mouth:"‚å¢",color:"#E25B45",label:"Angry"},surprised:{eyes:"‚óã",mouth:"O",color:"#E87C3F",label:"Surprised"}},de=[{type:1,difficulty:-2.5,answer:"happy",animal:"bear",context:null,description:"A bear with a big smile"},{type:1,difficulty:-2.2,answer:"sad",animal:"rabbit",context:null,description:"A rabbit looking down with tears"},{type:1,difficulty:-2,answer:"angry",animal:"bear",context:null,description:"A bear with a frown and furrowed brows"},{type:1,difficulty:-1.8,answer:"scared",animal:"bird",context:null,description:"A bird with wide eyes shaking"},{type:2,difficulty:-1.5,answer:"happy",animal:"rabbit",context:"birthday_cake",description:"A rabbit smiling at a birthday cake"},{type:2,difficulty:-1.2,answer:"sad",animal:"bear",context:"rain",description:"A bear looking sad in the rain"},{type:2,difficulty:-.8,answer:"scared",animal:"rabbit",context:"thunder",description:"A rabbit hiding during a thunderstorm"},{type:2,difficulty:-.5,answer:"angry",animal:"bird",context:"broken_toy",description:"A bird looking angry at a broken toy"},{type:3,difficulty:-.2,answer:"sad",animal:null,context:"dropped_ice_cream",description:"A dropped ice cream cone on the ground"},{type:3,difficulty:0,answer:"happy",animal:null,context:"gift",description:"A beautifully wrapped present"},{type:3,difficulty:.3,answer:"scared",animal:null,context:"dark_cave",description:"A dark cave entrance"},{type:4,difficulty:.5,answer:"surprised",animal:"bear",context:"gift",description:"A bear opening an unexpected gift"},{type:4,difficulty:.8,answer:"happy",animal:"rabbit",context:"friends",description:"A rabbit seeing friends arrive"},{type:4,difficulty:1,answer:"scared",animal:"bird",context:"new_place",description:"A bird in a new, unfamiliar forest"},{type:5,difficulty:1.3,answer:"sad",animal:"rabbit",context:"taken_toy",description:"A bear taking a toy from a rabbit"},{type:5,difficulty:1.5,answer:"happy",animal:"bird",context:"shared_food",description:"A bear sharing berries with a bird"},{type:5,difficulty:1.8,answer:"angry",animal:"bear",context:"pushed",description:"A rabbit accidentally bumping into a bear"},{type:6,difficulty:2,answer:"happy",animal:"bear",context:"before_rain",description:"How did the bear feel before it started raining? (Bear was playing happily)"},{type:6,difficulty:2.3,answer:"scared",animal:"rabbit",context:"before_rescue",description:"How did the rabbit feel before being rescued? (Rabbit was lost)"},{type:6,difficulty:2.5,answer:"surprised",animal:"bird",context:"before_party",description:"How did the bird feel when friends jumped out? (It was a surprise party)"}];function xe({emotion:t,size:n=60}){const i=S[t];if(!i)return null;const c=t==="angry"?"15":t==="sad"?"-10":"0",l=t==="scared"||t==="surprised"?22:24,g=t==="scared"||t==="surprised"?6:4,r=38;return e.jsxs("svg",{width:n,height:n,viewBox:"0 0 56 56",children:[e.jsx("circle",{cx:"28",cy:"28",r:"26",fill:i.color}),e.jsx("circle",{cx:"28",cy:"28",r:"26",fill:"white",opacity:"0.15"}),e.jsx("line",{x1:"14",y1:18,x2:"22",y2:18-parseInt(c)/3,stroke:"#4A3728",strokeWidth:"2",strokeLinecap:"round"}),e.jsx("line",{x1:"34",y1:18-parseInt(c)/3,x2:"42",y2:18,stroke:"#4A3728",strokeWidth:"2",strokeLinecap:"round"}),t==="happy"?e.jsxs(e.Fragment,{children:[e.jsx("path",{d:`M 15,${l} Q 19,${l-5} 23,${l}`,stroke:"#4A3728",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"}),e.jsx("path",{d:`M 33,${l} Q 37,${l-5} 41,${l}`,stroke:"#4A3728",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"})]}):e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"19",cy:l,r:g,fill:"#4A3728"}),e.jsx("circle",{cx:"37",cy:l,r:g,fill:"#4A3728"}),(t==="scared"||t==="surprised")&&e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"21",cy:l-2,r:"2",fill:"white"}),e.jsx("circle",{cx:"39",cy:l-2,r:"2",fill:"white"})]})]}),t==="happy"&&e.jsx("path",{d:`M 18,${r} Q 28,${r+10} 38,${r}`,stroke:"#4A3728",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"}),t==="sad"&&e.jsx("path",{d:`M 18,${r+5} Q 28,${r-3} 38,${r+5}`,stroke:"#4A3728",strokeWidth:"2.5",fill:"none",strokeLinecap:"round"}),(t==="scared"||t==="surprised")&&e.jsx("ellipse",{cx:"28",cy:r+2,rx:"5",ry:"6",fill:"#4A3728"}),t==="angry"&&e.jsx("path",{d:`M 20,${r+3} L 36,${r+3}`,stroke:"#4A3728",strokeWidth:"2.5",strokeLinecap:"round"}),t==="sad"&&e.jsxs(e.Fragment,{children:[e.jsx("ellipse",{cx:"15",cy:"32",rx:"2",ry:"3",fill:"#81C4E8",opacity:"0.7"}),e.jsx("ellipse",{cx:"41",cy:"32",rx:"2",ry:"3",fill:"#81C4E8",opacity:"0.7"})]})]})}function ye({scene:t}){const n=t.animal,i=t.answer;return e.jsxs("svg",{viewBox:"0 0 280 200",width:"100%",style:{maxWidth:300},children:[e.jsx("rect",{x:"0",y:"0",width:"280",height:"120",fill:"#B8D4C8",opacity:"0.4"}),e.jsx("rect",{x:"0",y:"120",width:"280",height:"80",fill:"#8BC48B",opacity:"0.3"}),t.context==="birthday_cake"&&e.jsxs("g",{transform:"translate(180, 80)",children:[e.jsx("rect",{x:"0",y:"20",width:"40",height:"30",rx:"4",fill:"#E8A0C8"}),e.jsx("rect",{x:"5",y:"25",width:"30",height:"5",fill:"#FFD4E8"}),e.jsx("line",{x1:"20",y1:"10",x2:"20",y2:"20",stroke:"#E8C84A",strokeWidth:"2"}),e.jsx("circle",{cx:"20",cy:"8",r:"4",fill:"#FFB84A"})]}),t.context==="rain"&&e.jsxs("g",{children:[e.jsx("rect",{x:"0",y:"0",width:"280",height:"60",fill:"#8BA8C8",opacity:"0.3"}),[40,80,130,180,220].map(c=>e.jsx("line",{x1:c,y1:"60",x2:c-5,y2:"90",stroke:"#81C4E8",strokeWidth:"1.5",opacity:"0.6"},c))]}),t.context==="dropped_ice_cream"&&e.jsxs("g",{transform:"translate(120, 130)",children:[e.jsx("ellipse",{cx:"20",cy:"30",rx:"15",ry:"5",fill:"#E8A0C8",opacity:"0.6"}),e.jsx("polygon",{points:"20,0 10,25 30,25",fill:"#E8C84A"}),e.jsx("circle",{cx:"20",cy:"-2",r:"10",fill:"#FFB8D4"})]}),t.context==="gift"&&e.jsxs("g",{transform:"translate(180, 95)",children:[e.jsx("rect",{x:"0",y:"10",width:"40",height:"35",rx:"3",fill:"#E25B45"}),e.jsx("rect",{x:"17",y:"10",width:"6",height:"35",fill:"#E8C84A"}),e.jsx("rect",{x:"0",y:"24",width:"40",height:"6",fill:"#E8C84A"}),e.jsx("path",{d:"M 20,10 Q 10,0 15,-5 Q 20,0 20,10",fill:"#E8C84A"}),e.jsx("path",{d:"M 20,10 Q 30,0 25,-5 Q 20,0 20,10",fill:"#E8C84A"})]}),t.context==="dark_cave"&&e.jsxs("g",{children:[e.jsx("ellipse",{cx:"140",cy:"130",rx:"80",ry:"60",fill:"#3C3C3C"}),e.jsx("ellipse",{cx:"140",cy:"130",rx:"60",ry:"45",fill:"#2C2C2C"})]}),n==="bear"&&e.jsxs("g",{transform:"translate(80, 50)",children:[e.jsx("circle",{cx:"30",cy:"12",r:"10",fill:"#D4A574"}),e.jsx("circle",{cx:"90",cy:"12",r:"10",fill:"#D4A574"}),e.jsx("ellipse",{cx:"60",cy:"50",rx:"35",ry:"32",fill:"#D4A574"}),e.jsx("ellipse",{cx:"60",cy:"55",rx:"22",ry:"18",fill:"#EDD5B3"}),i==="happy"&&e.jsx("path",{d:"M 48,52 Q 60,62 72,52",stroke:"#4A3728",strokeWidth:"2",fill:"none"}),i==="sad"&&e.jsx("path",{d:"M 48,58 Q 60,50 72,58",stroke:"#4A3728",strokeWidth:"2",fill:"none"}),i==="angry"&&e.jsx("line",{x1:"48",y1:"55",x2:"72",y2:"55",stroke:"#4A3728",strokeWidth:"2"}),i==="scared"&&e.jsx("ellipse",{cx:"60",cy:"55",rx:"5",ry:"6",fill:"#4A3728"}),e.jsx("circle",{cx:"48",cy:"40",r:"4",fill:"#4A3728"}),e.jsx("circle",{cx:"72",cy:"40",r:"4",fill:"#4A3728"}),e.jsx("ellipse",{cx:"60",cy:"47",rx:"4",ry:"3",fill:"#8B6B4E"})]}),n==="rabbit"&&e.jsxs("g",{transform:"translate(80, 30)",children:[e.jsx("ellipse",{cx:"48",cy:"10",rx:"8",ry:"28",fill:"#E0D0C0"}),e.jsx("ellipse",{cx:"72",cy:"10",rx:"8",ry:"28",fill:"#E0D0C0"}),e.jsx("ellipse",{cx:"48",cy:"10",rx:"5",ry:"22",fill:"#FFD4D4"}),e.jsx("ellipse",{cx:"72",cy:"10",rx:"5",ry:"22",fill:"#FFD4D4"}),e.jsx("ellipse",{cx:"60",cy:"60",rx:"28",ry:"25",fill:"#E0D0C0"}),i==="happy"&&e.jsx("path",{d:"M 48,65 Q 60,74 72,65",stroke:"#4A3728",strokeWidth:"2",fill:"none"}),i==="sad"&&e.jsx("path",{d:"M 48,70 Q 60,62 72,70",stroke:"#4A3728",strokeWidth:"2",fill:"none"}),i==="angry"&&e.jsx("line",{x1:"50",y1:"67",x2:"70",y2:"67",stroke:"#4A3728",strokeWidth:"2"}),i==="scared"&&e.jsx("ellipse",{cx:"60",cy:"67",rx:"4",ry:"5",fill:"#4A3728"}),e.jsx("circle",{cx:"50",cy:"52",r:"4",fill:"#E25B8B"}),e.jsx("circle",{cx:"70",cy:"52",r:"4",fill:"#E25B8B"}),e.jsx("circle",{cx:"50",cy:"52",r:"2",fill:"#4A3728"}),e.jsx("circle",{cx:"70",cy:"52",r:"2",fill:"#4A3728"}),e.jsx("ellipse",{cx:"60",cy:"60",rx:"3",ry:"2",fill:"#FFB8B8"})]}),n==="bird"&&e.jsxs("g",{transform:"translate(90, 55)",children:[e.jsx("ellipse",{cx:"50",cy:"40",rx:"25",ry:"22",fill:"#FFD84A"}),e.jsx("circle",{cx:"50",cy:"25",r:"16",fill:"#FFD84A"}),e.jsx("polygon",{points:"50,30 42,36 58,36",fill:"#E87C3F"}),i==="happy"&&e.jsx("path",{d:"M 42,40 Q 50,46 58,40",stroke:"#4A3728",strokeWidth:"1.5",fill:"none"}),e.jsx("circle",{cx:"43",cy:"22",r:"3",fill:"#4A3728"}),e.jsx("circle",{cx:"57",cy:"22",r:"3",fill:"#4A3728"}),e.jsx("ellipse",{cx:"30",cy:"40",rx:"12",ry:"8",fill:"#E8C84A"})]}),!n&&e.jsx("text",{x:"140",y:"60",textAnchor:"middle",fontFamily:"var(--font-game)",fontSize:"12",fill:"#4A3728",opacity:"0.7",children:t.description})]})}function N(t,n){const i=de.filter(c=>!n.has(c.difficulty));return i.length===0?null:(i.sort((c,l)=>Math.abs(c.difficulty-t)-Math.abs(l.difficulty-t)),i[0])}function he({ageBand:t,onComplete:n}){const[i,c]=a.useState(()=>ee(t)),[l,g]=a.useState(0),[r,Q]=a.useState(null),[z,L]=a.useState([]),[h,F]=a.useState(null),[D,v]=a.useState(null),[M,O]=a.useState([]),[w,H]=a.useState(new Set),[B,X]=a.useState({}),[A,Y]=a.useState(0),T=a.useRef(null),k=a.useRef(null);a.useEffect(()=>()=>{k.current&&clearTimeout(k.current)},[]);const E=a.useCallback(()=>{const s=N(i.b,w);if(!s)return;Q(s),H(y=>new Set([...y,s.difficulty]));const d=s.answer,b=oe.filter(y=>y!==d).sort(()=>Math.random()-.5).slice(0,3),o=[d,...b].sort(()=>Math.random()-.5);L(o),F(null),v(null),T.current=performance.now()},[i.b,w]);a.useEffect(()=>{E()},[]);const I=a.useCallback((s,d)=>{if(h!==null||!r)return;F(d);const x=performance.now()-T.current,b=ne(x,t),o=s===r.answer;o&&r.type>A&&Y(r.type),o||X(f=>{const j=`${r.answer}_as_${s}`;return{...f,[j]:(f[j]??0)+1}});const y={trialNum:l,correct:o,rt:x,rtNorm:b,difficulty:r.difficulty,sceneType:r.type,expectedEmotion:r.answer,chosenEmotion:s,module:"SC"},C=[...M,y],W=te(C,5)||x,G=$(C,W),K=re(l,G.fatigueOnset),u=ie(i,o,x,t,{responseWeight:K});c(u),v(o);const m=C;O(m);const _=l+1;if(se(u,_,ce,R)||!N(u.b,w)){k.current=setTimeout(()=>{const f=m.map(p=>p.rt),j=le(f),U=f.reduce((p,P)=>p+P,0)/f.length,V=$(m,W||U),q=Z(m.map(p=>({correct:p.correct,rtNorm:p.rtNorm,rt:p.rt})),j),J=ae(f);n({theta:u.theta,thetaSE:u.se,thetaCI:u.ci,itv:j,ddm:q,engagementFatigued:V.fatigued,trials:m,extras:{highestSceneType:o&&r.type>A?r.type:A,confusionMatrix:B,exgauss:J}})},800);return}g(_),k.current=setTimeout(()=>E(),800)},[h,r,i,l,M,t,A,w,B,n,E]);return r?e.jsxs("div",{className:"game-area",style:{background:"#E4DDE8",position:"relative"},children:[e.jsxs("svg",{viewBox:"0 0 800 600",style:{position:"absolute",inset:0,width:"100%",height:"100%"},"aria-hidden":"true",children:[e.jsx("rect",{x:"0",y:"0",width:"800",height:"600",fill:"#E4DDE8"}),e.jsx("rect",{x:"0",y:"380",width:"800",height:"220",fill:"#C8E0C8",opacity:"0.4"}),[100,250,450,600,720].map(s=>e.jsxs("g",{transform:`translate(${s}, ${410+Math.random()*40})`,children:[e.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"20",stroke:"#5B8C5A",strokeWidth:"2"}),e.jsx("circle",{cx:"0",cy:"-2",r:"5",fill:["#E8A0C8","#E8C84A","#B8A0E8"][Math.floor(Math.random()*3)]})]},s))]}),e.jsx("div",{style:{position:"absolute",top:8,left:0,right:0,textAlign:"center",fontFamily:"var(--font-game, 'Nunito')",fontSize:"clamp(0.8rem, 2vw, 1rem)",color:"#2C3E35",zIndex:10,padding:"0 16px"},children:"How is the friend feeling?"}),e.jsx("div",{style:{position:"absolute",top:"8%",left:"50%",transform:"translateX(-50%)",zIndex:5},children:e.jsx(ye,{scene:r})}),e.jsx("div",{style:{position:"absolute",bottom:"8%",left:"50%",transform:"translateX(-50%)",display:"flex",gap:12,zIndex:5},children:z.map((s,d)=>{const x=h===d,b=h!==null;let o="transparent";return b&&x&&(o=s===r.answer?"#4A7C6F":"#D4956A"),e.jsxs("button",{onClick:()=>I(s,d),onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&I(s,d)},role:"button",tabIndex:0,"aria-label":S[s]?.label??s,disabled:h!==null,style:{border:`3px solid ${o}`,borderRadius:16,background:"white",cursor:h!==null?"default":"pointer",padding:6,display:"flex",flexDirection:"column",alignItems:"center",gap:4,transition:"border-color 0.2s, transform 0.15s",transform:x?"scale(1.05)":"scale(1)",boxShadow:"var(--shadow-sm)",minHeight:44,minWidth:44},children:[e.jsx(xe,{emotion:s,size:48}),e.jsx("span",{style:{fontFamily:"var(--font-game, 'Nunito')",fontSize:"0.7rem",color:"var(--text-dark)"},children:S[s]?.label})]},d)})}),D!==null&&e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"2.5rem",zIndex:20,pointerEvents:"none",animation:"softBounce 0.6s ease-out"},"aria-hidden":"true",children:D?"‚≠ê":"üíö"}),e.jsxs("div",{style:{position:"absolute",bottom:8,right:12,fontFamily:"var(--font-game, 'Nunito')",fontSize:"0.8rem",color:"#6B7F78",zIndex:10},"aria-hidden":"true",children:[l+1,"/",R]})]}):e.jsx("div",{className:"game-area",style:{background:"#E4DDE8",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("span",{style:{fontFamily:"var(--font-game)",color:"var(--text-light)"},children:"Loading..."})})}export{he as default};
