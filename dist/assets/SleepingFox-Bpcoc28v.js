import{r as o,e as H,j as t}from"./index-Czv1AGCs.js";import{c as J,h as U,u as A,b as Y,a as Z,d as $,e as tt,n as O}from"./consistency-BpvqZ4ZH.js";const g=40,et=.7;function rt({ageBand:l,onComplete:B}){const[i,T]=o.useState(()=>J(l)),[p,P]=o.useState(0),[w,_]=o.useState(!0),[f,G]=o.useState("waiting"),[h,m]=o.useState(null),[r,j]=o.useState([]),[b,X]=o.useState(!1),W=o.useRef(null),y=o.useRef(null),k=o.useRef(!1),N=o.useCallback(()=>{y.current&&(clearTimeout(y.current),y.current=null)},[]);o.useEffect(()=>()=>N(),[N]);const M=o.useCallback(()=>{if(p>=g)return;const s=Math.random()<et;_(s),G("stimulus"),m(null),k.current=!1,W.current=performance.now();const n=U(i.b),a=s?n.goDuration:n.stopDuration;y.current=setTimeout(()=>{if(!k.current)if(s){const c=a,D=O(c,l),v=A(i,!1,c,l);T(v),j(R=>[...R,{correct:!1,rt:c,rtNorm:D,type:"omission",isGo:!0,module:"EF"}]),m("miss")}else j(c=>[...c,{correct:!0,rt:0,rtNorm:0,type:"correct_reject",isGo:!1,module:"EF"}]),m("good");G("isi");const x=400+Math.random()*200;y.current=setTimeout(()=>{P(c=>c+1)},x)},a)},[p,i,l]);o.useEffect(()=>{if(p>=g&&!b){X(!0);const s=r.filter(e=>e.type==="hit").map(e=>e.rt),n=r.filter(e=>e.rt>0).map(e=>e.rt),a=Y(s.length>1?s:n),x=n.length>0?n.reduce((e,u)=>e+u,0)/n.length:1200,c=Z(r,6)||x,D=$(r,c),v=H(r.filter(e=>e.rt>0).map(e=>({correct:e.correct,rtNorm:e.rtNorm,rt:e.rt})),a),R=tt(n),C=r.filter(e=>e.isGo),I=r.filter(e=>!e.isGo),K=I.length>0?I.filter(e=>e.type==="commission").length/I.length:0,V=C.length>0?C.filter(e=>e.type==="omission").length/C.length:0,E=r.filter(e=>e.type==="hit").map(e=>e.rt),S=E.length>0?E.reduce((e,u)=>e+u,0)/E.length:0;let L=1;const Q=r.map((e,u)=>e.type==="commission"?u:-1).filter(e=>e>=0);if(Q.length>0&&E.length>0){const e=Q.map(u=>{for(let d=u+1;d<r.length;d++)if(r[d].type==="hit")return r[d].rt;return null}).filter(Boolean);if(e.length>0){const u=e.reduce((d,q)=>d+q,0)/e.length;L=S>0?u/S:1}}B({theta:i.theta,thetaSE:i.se,thetaCI:i.ci,itv:a,ddm:v,engagementFatigued:D.fatigued,trials:r,extras:{commissionRate:K,omissionRate:V,meanGoRT:S,postErrorSlowing:L,exgauss:R}});return}p<g&&!b&&M()},[p,b,r,i.theta,i.se,i.ci,B,M]);const z=o.useCallback(()=>{if(f!=="stimulus"||k.current)return;k.current=!0;const s=performance.now()-W.current,n=O(s,l);if(w){const a=A(i,!0,s,l);T(a),j(x=>[...x,{correct:!0,rt:s,rtNorm:n,type:"hit",isGo:!0,module:"EF"}]),m("hit")}else{const a=A(i,!1,s,l);T(a),j(x=>[...x,{correct:!1,rt:s,rtNorm:n,type:"commission",isGo:!1,module:"EF"}]),m("oops")}},[f,w,i,l]),F=w&&f==="stimulus";return t.jsxs("div",{className:"game-area",style:{background:"#C8D4D8",position:"relative"},children:[t.jsxs("svg",{viewBox:"0 0 800 600",style:{position:"absolute",inset:0,width:"100%",height:"100%"},"aria-hidden":"true",children:[t.jsx("rect",{x:"0",y:"0",width:"800",height:"600",fill:"#C8D4D8"}),t.jsx("rect",{x:"0",y:"420",width:"800",height:"180",fill:"#6B8C5A",opacity:"0.3"}),t.jsx("ellipse",{cx:"100",cy:"440",rx:"80",ry:"20",fill:"#5B7C4A",opacity:"0.3"}),t.jsx("ellipse",{cx:"650",cy:"450",rx:"100",ry:"25",fill:"#5B7C4A",opacity:"0.25"}),t.jsx("path",{d:"M0 350 Q50 380, 30 420 Q10 450, 0 500",stroke:"#8B6B4E",strokeWidth:"8",fill:"none",opacity:"0.3"}),t.jsx("path",{d:"M800 320 Q750 370, 770 420 Q790 460, 800 500",stroke:"#8B6B4E",strokeWidth:"8",fill:"none",opacity:"0.3"})]}),t.jsx("div",{style:{position:"absolute",top:12,left:0,right:0,textAlign:"center",fontFamily:"var(--font-game, 'Nunito')",fontSize:"clamp(0.8rem, 2vw, 1rem)",color:"#2C3E35",zIndex:10,padding:"0 16px"},children:l<=3?"Tap the drum when eyes are closed!":"Shhh! Tap the drum when the fox sleeps. Freeze when eyes open!"}),t.jsx("div",{style:{position:"absolute",top:"15%",left:"50%",transform:"translateX(-50%)",zIndex:5},children:t.jsxs("svg",{width:"200",height:"200",viewBox:"0 0 200 200",children:[t.jsx("polygon",{points:"40,80 60,20 80,80",fill:"#E87C3F"}),t.jsx("polygon",{points:"50,75 60,35 70,75",fill:"#FFD4B8"}),t.jsx("polygon",{points:"120,80 140,20 160,80",fill:"#E87C3F"}),t.jsx("polygon",{points:"130,75 140,35 150,75",fill:"#FFD4B8"}),t.jsx("ellipse",{cx:"100",cy:"120",rx:"65",ry:"55",fill:"#E87C3F"}),t.jsx("ellipse",{cx:"100",cy:"135",rx:"40",ry:"35",fill:"#FFE8D4"}),F?t.jsxs(t.Fragment,{children:[t.jsx("path",{d:"M 72,108 Q 80,115 88,108",stroke:"#4A3728",strokeWidth:"3",strokeLinecap:"round",fill:"none"}),t.jsx("path",{d:"M 112,108 Q 120,115 128,108",stroke:"#4A3728",strokeWidth:"3",strokeLinecap:"round",fill:"none"})]}):t.jsxs(t.Fragment,{children:[t.jsx("ellipse",{cx:"80",cy:"108",rx:"8",ry:"9",fill:"#4A3728"}),t.jsx("ellipse",{cx:"120",cy:"108",rx:"8",ry:"9",fill:"#4A3728"}),t.jsx("circle",{cx:"83",cy:"105",r:"3",fill:"white"}),t.jsx("circle",{cx:"123",cy:"105",r:"3",fill:"white"})]}),t.jsx("ellipse",{cx:"100",cy:"130",rx:"7",ry:"5",fill:"#2C2C2C"}),t.jsx("path",{d:"M 93,137 Q 100,143 107,137",stroke:"#8B6B4E",strokeWidth:"1.5",fill:"none"}),t.jsx("line",{x1:"50",y1:"125",x2:"75",y2:"128",stroke:"#D4A574",strokeWidth:"1",opacity:"0.5"}),t.jsx("line",{x1:"50",y1:"135",x2:"75",y2:"133",stroke:"#D4A574",strokeWidth:"1",opacity:"0.5"}),t.jsx("line",{x1:"150",y1:"125",x2:"125",y2:"128",stroke:"#D4A574",strokeWidth:"1",opacity:"0.5"}),t.jsx("line",{x1:"150",y1:"135",x2:"125",y2:"133",stroke:"#D4A574",strokeWidth:"1",opacity:"0.5"})]})}),t.jsx("button",{onClick:z,onKeyDown:s=>{(s.key==="Enter"||s.key===" ")&&z()},role:"button",tabIndex:0,"aria-label":F?"Tap the drum now!":"Don't tap - fox is awake!",disabled:f!=="stimulus",style:{position:"absolute",bottom:"12%",left:"50%",transform:"translateX(-50%)",width:100,height:100,border:"none",background:"transparent",cursor:f==="stimulus"?"pointer":"default",padding:0,zIndex:10,animation:F&&f==="stimulus"?"pulse 1s ease-in-out infinite":"none"},children:t.jsxs("svg",{width:"100",height:"100",viewBox:"0 0 100 100",children:[t.jsx("ellipse",{cx:"50",cy:"70",rx:"40",ry:"15",fill:"#8B4513"}),t.jsx("rect",{x:"10",y:"35",width:"80",height:"35",fill:"#CD853F"}),t.jsx("ellipse",{cx:"50",cy:"35",rx:"40",ry:"15",fill:"#DEB887"}),t.jsx("path",{d:"M 15,45 L 25,55 L 15,65",stroke:"#8B4513",strokeWidth:"2",fill:"none",opacity:"0.5"}),t.jsx("path",{d:"M 85,45 L 75,55 L 85,65",stroke:"#8B4513",strokeWidth:"2",fill:"none",opacity:"0.5"}),t.jsx("line",{x1:"35",y1:"15",x2:"55",y2:"35",stroke:"#654321",strokeWidth:"3",strokeLinecap:"round"}),t.jsx("line",{x1:"65",y1:"15",x2:"45",y2:"35",stroke:"#654321",strokeWidth:"3",strokeLinecap:"round"}),t.jsx("circle",{cx:"35",cy:"15",r:"4",fill:"#DEB887"}),t.jsx("circle",{cx:"65",cy:"15",r:"4",fill:"#DEB887"})]})}),h&&t.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"2rem",fontFamily:"var(--font-game, 'Nunito')",color:h==="hit"||h==="good"?"var(--primary)":"var(--warning)",zIndex:20,pointerEvents:"none",animation:"fadeIn 0.2s ease-out"},"aria-hidden":"true",children:[h==="hit"&&"âœ“",h==="good"&&"ðŸ¤«",h==="oops"&&"ðŸ˜®",h==="miss"&&"ðŸ’¤"]}),t.jsxs("div",{style:{position:"absolute",bottom:8,right:12,fontFamily:"var(--font-game, 'Nunito')",fontSize:"0.8rem",color:"#6B7F78",zIndex:10},"aria-hidden":"true",children:[Math.min(p+1,g),"/",g]})]})}export{rt as default};
