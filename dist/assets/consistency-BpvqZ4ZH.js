const L={2:-1.5,3:-1,4:-.5,5:-.25,6:0},N={2:2200,3:1800,4:1400,5:1100,6:900},R={2:2,3:3,4:4,5:4,6:5};function S(t){return{theta:0,b:L[t]??-.5,a:1,c:.25,responses:[],se:1/0}}function d(t,e,n=1,o=.25){return o+(1-o)/(1+Math.exp(-n*(t-e)))}function X(t,e,n,o,s={}){const{theta:c,b:u,a:i,c:a,responses:T}=t,h=s.responseWeight??1,r=N[o]??1400,f=n>2*r?.75:n>r?.9:1,g={correct:e,rt:n,difficulty:u,a:i,c:a,weight:Math.max(.4,Math.min(1.2,h*f))},_=[...T,g],M=B(_,c),E=b(_,M,i,a),A=H(M,E),I=x(M,i,a);return{...t,theta:M,b:I,responses:_,se:E,ci:A}}function x(t,e=1,n=.25){const o=Math.log((1+Math.sqrt(1+8*n))/2)/Math.max(.5,e);return l(t+o,-2.5,2.5)}function b(t,e,n,o){if(t.length<2)return 1/0;let s=0;for(const c of t){const u=c.a??n,i=c.c??o,a=d(e,c.difficulty,u,i),T=1-a,h=(a-i)/(1-i),r=c.weight??1;s+=r*u*u*T*h*h/a}return s>0?1/Math.sqrt(s):1/0}function B(t,e){if(t.length===0)return e;let n=l(e,-3,3);for(let o=0;o<12;o++){let s=-n/1,c=-1/1;for(const T of t){const h=T.a??1,r=T.c??.25,f=T.weight??1,g=T.correct?1:0,_=d(n,T.difficulty,h,r),M=1-_,E=h*(_-r)*M/(1-r),A=l(_,1e-6,1-1e-6),I=(g-A)*E/(A*(1-A)),D=E*E/(A*(1-A));s+=f*I,c-=f*D}if(Math.abs(s)<1e-4)break;const u=c===0?0:s/c,i=l(u,-.6,.6),a=l(n-i,-3,3);if(Math.abs(a-n)<1e-4){n=a;break}n=a}return l(n,-3,3)}function H(t,e){if(!Number.isFinite(e))return{lower:-3,upper:3,width:6};const n=1.96*e,o=l(t-n,-3,3),s=l(t+n,-3,3);return{lower:o,upper:s,width:s-o}}function y(t,e){const n=R[e]??3,o=Math.round(t);return l(n+o,2,8)}function P(t,e){const n=N[e]??1400;return t/n}function C(t,e,n,o,s=.3){return e>=o||e>=n&&t.se<s}function W(t,e){const n=(t- -2.5)/5,o=4e3-n*2500,s=n<.33?1:n<.66?2:3,c=2500-n*1e3;return{fallDuration:Math.max(o,1500),simultaneousLeaves:s,tapWindow:Math.max(c,1500)}}function F(t){const e=(t- -2.5)/5,n=1200-e*400,o=600-e*200,s=400+Math.random()*200;return{goDuration:Math.max(n,800),stopDuration:Math.max(o,400),isi:s}}function l(t,e,n){return Math.max(e,Math.min(n,t))}const O=.4,w=.4,m=3;function U(t){if(t.length<2)return 0;const e=t.reduce((o,s)=>o+s,0)/t.length;if(e===0)return 0;const n=t.reduce((o,s)=>o+(s-e)**2,0)/t.length;return Math.sqrt(n)/e}function q(t){if(!t.length)return{mu:0,sigma:0,tau:0};if(t.length<4)return{mu:t.reduce((f,g)=>f+g,0)/t.length,sigma:0,tau:0};const e=[...t].sort((r,f)=>r-f),n=e.reduce((r,f)=>r+f,0)/e.length,o=e.reduce((r,f)=>r+(f-n)**2,0)/e.length,s=Math.sqrt(o),c=p(e,.1),u=p(e,.9),i=Math.max(0,u-c-2.56*s),a=Math.max(0,i/2),T=Math.max(1,Math.sqrt(Math.max(1,o-a*a)));return{mu:Math.max(0,n-a),sigma:T,tau:a}}function G(t,e){if(t.length<m+1)return{fatigued:!1,fatigueOnset:null};for(let n=m;n<=t.length;n++){const o=t.slice(n-m,n),s=o.reduce((u,i)=>u+i.rt,0)/m,c=o.filter(u=>u.correct).length/m;if(s>e*(1+O)&&c<w)return{fatigued:!0,fatigueOnset:n-m}}return{fatigued:!1,fatigueOnset:null}}function v(t,e){return e!==null&&t>=e?.7:1}function z(t,e=5){const n=t.slice(0,e).map(s=>s.rt).filter(s=>s>0);if(!n.length)return 0;const o=n.sort((s,c)=>s-c);return p(o,.5)}function p(t,e){if(!t.length)return 0;const n=(t.length-1)*e,o=Math.floor(n),s=n-o,c=t[o+1]??t[o];return t[o]+s*(c-t[o])}export{z as a,U as b,S as c,G as d,q as e,y as f,W as g,F as h,P as n,C as s,v as t,X as u};
